# 计算图基础

## 什么是计算图？

计算图（Computational Graph）是一种将数学表达式表示为有向图的数据结构。图中的节点代表变量或操作，边代表数据流动的方向。这种表示方法不仅直观，而且为自动微分提供了数学基础。

```{admonition} 计算图的正式定义
:class: note

计算图 $G = (V, E)$ 是一个有向图，其中：

- $V$ 是节点集合，包括：
  - **输入节点**：表示变量或常数
  - **操作节点**：表示数学运算（加法、乘法、函数等）
  - **输出节点**：表示最终计算结果
- $E$ 是边集合，表示数据依赖关系
- 每个节点 $v \in V$ 都有一个对应的值 $val(v)$
- 边 $(u, v) \in E$ 表示节点 $u$ 的值是节点 $v$ 的输入
```

## 计算图的基本元素

```{figure} ../../_static/images/computational_diagram.png
:width: 80%
:align: center

计算图示例：$f(x,y) = (x+y) \times y$
```

### 节点类型

```{admonition} 输入节点（Input Nodes）
:class: note

- 表示模型的输入变量或常数
- 通常是计算图的起点
- 在训练过程中，这些节点的值会被赋予具体数值
- 示例：$x$, $y$, $w$, $b$ 等
```

```{admonition} 操作节点（Operation Nodes）
:class: note

- 表示数学运算或函数
- 接收一个或多个输入，产生一个输出
- 示例：加法(+)、乘法($\times$)、sigmoid($\sigma$)、ReLU等
- 每个操作节点都对应一个前向计算和反向传播规则
```

### 边的语义

边在计算图中承载着重要的语义信息：

- **数据流**：表示数值从源节点流向目标节点
- **依赖关系**：显示计算过程中的依赖关系
- **梯度传播**：在反向传播中，梯度沿着边反向流动
- **计算顺序**：边的方向决定了计算的拓扑顺序

## 计算图的构建规则

构建计算图需要遵循特定的规则，以确保计算的正确性和效率：

```{admonition} 构建原则
:class: note

1. **无环性**：计算图必须是有向无环图（DAG），避免循环依赖
2. **完整性**：每个操作节点的所有输入都必须有明确的来源
3. **一致性**：数据类型和维度必须匹配
4. **可微分性**：所有操作节点必须支持前向计算和反向传播
```

## 复杂模型的表示

现代深度学习模型可以表示为极其复杂的计算图。以逻辑回归为例：

```{figure} ../../_static/images/gradient_descent.png
:width: 80%
:align: center

逻辑回归的计算图表示
```
